<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rate Teams</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18",
        "react-dom": "https://esm.sh/react-dom@18",
        "react-dom/client": "https://esm.sh/react-dom@18/client",
        "framer-motion": "https://esm.sh/framer-motion@10",
        "react-toastify": "https://esm.sh/react-toastify@9",
        "react-confetti": "https://esm.sh/react-confetti@1"
      }
    }
  </script>
  <link rel="stylesheet" href="https://esm.sh/react-toastify@9/dist/ReactToastify.css" />
  <style>
    .team-logo {
      width: 30px;
      height: 30px;
      object-fit: contain;
      margin-right: 8px;
      vertical-align: middle;
    }
  </style>
</head>
<body class="bg-gray-100 p-4 min-h-screen flex items-center justify-center">
  <div id="app" class="max-w-4xl w-full"></div>
  <script type="module">
    import React from 'react';
    import { createRoot } from 'react-dom/client';
    import { TeamRater } from './dist/components/TeamRater.js';
    import { ToastContainer } from 'react-toastify';

    const demoTeams = [
      {
        id: '1',
        name: 'Demo Team',
        players: {
          QB: ['Patrick Mahomes', 'Jalen Hurts', 'Lamar Jackson'],
          RB: [
            'Christian McCaffrey',
            'Austin Ekeler',
            'Bijan Robinson',
            'Saquon Barkley',
            'Jonathan Taylor',
            'Nick Chubb'
          ],
          WR: [
            'Justin Jefferson',
            "Ja'Marr Chase",
            'Cooper Kupp',
            'Tyreek Hill',
            'Stefon Diggs',
            'A.J. Brown',
            'CeeDee Lamb',
            'Davante Adams'
          ],
          TE: ['Travis Kelce', 'Mark Andrews']
        }
      },
      {
        id: '2',
        name: 'Second Team',
        players: {
          QB: ['Josh Allen'],
          RB: ['Aaron Jones'],
          WR: ['Mike Evans'],
          TE: ['George Kittle']
        }
      }
    ];

    const stats = { teamsRated: 0, xp: 0, level: 1, streak: 0, percentile: 0 };
    let idx = 0;
    const originalFetch = window.fetch.bind(window);
    window.fetch = async (url, opts) => {
      if (url.endsWith('/api/nextTeam')) {
        const team = demoTeams[idx % demoTeams.length];
        idx++;
        return new Response(JSON.stringify(team), { headers: { 'Content-Type': 'application/json' } });
      }
      if (url.endsWith('/api/rate')) {
        stats.teamsRated++;
        stats.xp += 5;
        stats.level = Math.floor(stats.xp / 100) + 1;
        stats.streak++;
        stats.percentile = Math.max(0, 100 - stats.teamsRated);
        return new Response(JSON.stringify(stats), { headers: { 'Content-Type': 'application/json' } });
      }
      return originalFetch(url, opts);
    };

    const root = createRoot(document.getElementById('app'));

    async function start() {
      const res = await fetch('/api/nextTeam');
      const team = await res.json();
      root.render(
        React.createElement(React.Fragment, null,
          React.createElement(TeamRater, { initialTeam: team, initialStats: stats }),
          React.createElement(ToastContainer, { position: 'bottom-center' })
        )
      );
    }

    start();
  </script>
</body>
</html>
