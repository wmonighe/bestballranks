<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload CSV</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    #message {
      margin-top: 1rem;
      font-weight: bold;
    }
  #teams{display:flex;flex-wrap:wrap;gap:1rem;}
  .team-card{border:1px solid #ddd;padding:1rem;margin-top:1rem;border-radius:4px;flex:1 0 calc(33.333% - 1rem);box-sizing:border-box;}
  .team-card h2{margin-top:0;}
  .team-card table{width:100%;border-collapse:collapse;margin-top:0.5rem;}
  .team-card th,.team-card td{border:1px solid #ccc;padding:4px;text-align:left;font-size:0.9rem;}
  </style>
</head>
<body>
  <h1>Upload CSV</h1>
  <input type="file" id="file-input" accept=".csv">
  <div id="message"></div>
  <div id="teams"></div>

  <script>
    const requiredHeaders = [
      "Picked At",
      "Pick Number",
      "Appearance",
      "First Name",
      "Last Name",
      "Team",
      "Position",
      "Draft",
      "Draft Entry",
      "Draft Entry Fee",
      "Draft Size",
      "Draft Total Prizes",
      "Tournament Title",
      "Tournament",
      "Tournament Entry Fee",
      "Tournament Total Prizes",
      "Tournament Size",
      "Draft Pool Title",
      "Draft Pool",
      "Draft Pool Entry Fee",
      "Draft Pool Total Prizes",
      "Draft Pool Size",
      "Weekly Winner Title",
      "Weekly Winner",
      "Weekly Winner Entry Fee",
      "Weekly Winner Total Prizes",
      "Weekly Winner Size"
    ];

    document.getElementById("file-input").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const text = event.target.result.trim();
          const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
          const headers = lines[0].split(',').map(h => h.trim());
          const allPresent = requiredHeaders.every(h => headers.includes(h));
          const msgEl = document.getElementById("message");
          const teamsEl = document.getElementById("teams");
          teamsEl.innerHTML = "";
          if (!allPresent) {
            msgEl.textContent = "Upload Failed.";
            return;
          }
          msgEl.textContent = "Upload Successful.";
          const rows = lines.slice(1).map(line => {
            const values = line.split(',').map(v => v.trim());
            const obj = {};
            headers.forEach((h, i) => obj[h] = values[i]);
            return obj;
          });
          const teams = {};
          rows.forEach(r => {
            const key = r["Draft Entry"];
            if (!teams[key]) {
              teams[key] = { tournamentTitle: r["Tournament Title"], entryFee: r["Tournament Entry Fee"], picks: [] };
            }
            teams[key].picks.push(r);
          });
          Object.values(teams).forEach(team => {
            team.picks.sort((a,b) => parseInt(a["Pick Number"],10) - parseInt(b["Pick Number"],10));
            const card = document.createElement("div");
            card.className = "team-card";
            const header = document.createElement("h2");
            header.textContent = `${team.tournamentTitle} - $${team.entryFee}`;
            card.appendChild(header);
            const table = document.createElement("table");
            const thead = document.createElement("thead");
            thead.innerHTML = "<tr><th>Pick Number</th><th>First Name</th><th>Last Name</th><th>Team</th><th>Position</th></tr>";
            table.appendChild(thead);
            const tbody = document.createElement("tbody");
            team.picks.forEach(p => {
              const tr = document.createElement("tr");
              tr.innerHTML = `<td>${p["Pick Number"]}</td><td>${p["First Name"]}</td><td>${p["Last Name"]}</td><td>${p["Team"]}</td><td>${p["Position"]}</td>`;
              tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            card.appendChild(table);
            teamsEl.appendChild(card);
          });
        } catch (err) {
          document.getElementById("message").textContent = "Upload Failed.";
        }
      };
      reader.onerror = function() {
        document.getElementById("message").textContent = "Upload Failed.";
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
